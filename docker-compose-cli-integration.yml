version: '3.2'
services:
  hailstorm-db:
    image: "mysql:5"
    hostname: "hailstorm-db"
    networks:
      - hailstorm_integration
    volumes:
      - type: volume
        source: hailstorm-db-vol
        target: /var/lib/mysql
    environment:
      MYSQL_ROOT_PASSWORD: 'i r baboon'

  cli:
    image: "hailstorm/hailstorm-cli-integration:1.0.0"
    hostname: "hailstorm-cli"
    networks:
      - hailstorm_integration
    depends_on:
      - hailstorm-db
    command: ["cucumber", "--tags", "@smoke"]

  hailstorm-site:
    image: "hailstorm/hailstorm_site:1.0.0"
    hostname: "hailstorm-site"
    networks:
      hailstorm_integration:
        ipv4_address: 192.168.20.100
    depends_on:
      - hailstorm-db

  hailstorm-agent-1:
    image: "hailstorm/hailstorm_agent:1.0.0"
    hostname: "hailstorm-agent-1"
    networks:
      hailstorm_integration:
        ipv4_address: 192.168.20.10
    depends_on:
      - hailstorm-site

  hailstorm-agent-2:
    image: "hailstorm/hailstorm_agent:1.0.0"
    hostname: "hailstorm-agent-2"
    networks:
      hailstorm_integration:
        ipv4_address: 192.168.20.20
    depends_on:
      - hailstorm-site

networks:
  hailstorm_integration:
    driver: bridge
    ipam:
      driver: default
      config:
        - subnet: 192.168.20.0/24

volumes:
  hailstorm-db-vol:
