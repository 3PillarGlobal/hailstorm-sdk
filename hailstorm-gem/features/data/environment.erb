# Hailstorm configuration
Hailstorm.application.config do |config|

    # This is the JMeter configuration
    config.jmeter do |jmeter|
        # default properties for all app/**/*.jmx files
        jmeter.properties() do |map|
        <%- @properties.each do |p| %>
            map['<%= raw p.property %>'] = <%= raw(p.value =~ /[a-zA-Z]/ ? "'#{p.value}'": p.value) %>
        <%- end %>
        end
    end

    # Cluster configuration
    <%- @clusters.each do |p| %>
    config.clusters(:<%= p.cluster_type %>) do |cluster|
      <%- p.except(:cluster_type).to_h.keys.each do |key| %>
      <%- if p.send(key) %>
        cluster.<%= key %> = '<%= p.send(key) %>'
      <%- end %>
      <%- end %>
    end
    <%- end %>

    # Target configuration
    config.monitors(:nmon) do |monitor|
        monitor.executable_path   = '/usr/bin/nmon'
        monitor.ssh_identity      = 'all_purpose'
        monitor.user_name         = 'ubuntu'
        monitor.sampling_interval = 5
        monitor.active = <%= @monitor_active %>

        monitor.groups('Application Server') do |group|
            group.hosts('<%= @monitor_host %>')
        end
    end

end
