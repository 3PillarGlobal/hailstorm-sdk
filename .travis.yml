# Travis Configuration
services:
  - mysql

env:
  global:
    - AWS_DEFAULT_REGION=us-east-1
    - CC_TEST_REPORTER_ID=3e42f82fe2b2f0601cafe4eca93a8c9d296dfa8f7af67d2e846a182a834bde59
    - CI_NODE_TOTAL=6

stages:
  - name: test
  # - name: coverage

jobs:
  include:
    - stage: test
      name: "hailstorm-gem test"
      language: ruby
      rvm: jruby-9.1.9.0
      jdk: openjdk8
      env:
        - CI_NODE_INDEX=0
      before_install:
        - make install_aws
      install:
        - make PROJECT=gem install
      script:
        - make PROJECT=gem test

    - stage: test
      name: "hailstorm-cli test"
      language: ruby
      rvm: jruby-9.1.9.0
      jdk: openjdk8
      env:
        - CI_NODE_INDEX=1
      before_install:
        - make install_aws
      install:
        - make PROJECT=cli install
      script:
        - make PROJECT=cli test

    - stage: test
      name: "hailstorm-api test"
      language: ruby
      rvm: jruby-9.1.9.0
      jdk: openjdk8
      env:
        - CI_NODE_INDEX=2
      before_install:
        - make install_aws
      install:
        - make PROJECT=api install
      script:
        - make PROJECT=api test

    - stage: test
      name: "hailstorm-file-server test"
      language: java
      jdk: openjdk8
      env:
        - CI_NODE_INDEX=3
      before_install:
        - make install_aws
      install:
        - make PROJECT=file-server install
      script:
        - make PROJECT=file-server test

    - stage: test
      name: "hailstorm-client-exchange test"
      language: java
      jdk: openjdk8
      env:
        - CI_NODE_INDEX=4
      before_install:
        - make install_aws
      install:
        - make PROJECT=client-exchange install
      script:
        - make PROJECT=client-exchange test

    - stage: test
      name: "hailstorm-web-client test"
      language: node_js
      node_js: lts/dubnium
      env:
        - CI_NODE_INDEX=5
      before_install:
        - make install_aws
      install:
        - make PROJECT=web-client install
      script:
        - make PROJECT=web-client test


    # - stage: coverage
    #   name: "hailstorm-gem coverage"
    #   language: ruby
    #   rvm: jruby-9.1.9.0
    #   jdk: openjdk8
    #   env:
    #     - CI_NODE_INDEX=0
    #   before_install:
    #     - make install_aws
    #   install:
    #     - make PROJECT=gem FORCE=yes install
    #   script:
    #     - make PROJECT=gem FORCE=yes coverage
    #   after_script:
    #     - make PROJECT=gem FORCE=yes cc_test_report
